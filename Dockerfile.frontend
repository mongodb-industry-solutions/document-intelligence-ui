FROM node:22-alpine

# Accept build arguments
ARG NEXT_PUBLIC_API_URL=http://localhost:8080
ARG NODE_ENV=dev

# Set environment variables for build process
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL
ENV NODE_ENV=$NODE_ENV

WORKDIR /app
COPY frontend/package*.json ./
RUN npm install
COPY frontend/ .

# Build Next.js app (NEXT_PUBLIC_* vars are embedded here)
RUN npm run build

EXPOSE 8080
CMD ["npm", "run", "start"]